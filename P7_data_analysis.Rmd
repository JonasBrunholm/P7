---
title: "P7_Data_analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
Sys.setenv(language="en")

library(tidyquant)
library(tidyverse)
library(zoo)
library(gridExtra)
```

```{r Plots af r√•data}

Pandora_data <- tq_get("PNDORA.CO", get = "stock.prices", from = "2010-01-01", to = "2020-09-08")
ggplot(Pandora_data, aes(x = date, y = adjusted)) +
  geom_line()

Bitcoin_data <- tq_get("BTC-USD", get = "stock.prices", from = "2010-01-01", to = "2020-09-08")

ggplot(Bitcoin_data, aes(x = date, y = adjusted)) +
  geom_line()

DAX_data <- tq_get("^GDAXI", get = "stock.prices", from = "2010-01-01", to = "2020-09-08")
ggplot(DAX_data, aes(x = date, y = adjusted)) +
  geom_line()
```

```{r MA 200 BTC}
#tjek for NA
NA_BTC <- which(is.na(Bitcoin_data$adjusted) == TRUE)
BTC_Close <- Bitcoin_data$adjusted[-c(NA_BTC)]

MA200_BTC <- c(rep(0,200),rollmean(BTC_Close,200))

#Date_MA <- Bitcoin_data$date[-c(1:200)]
#MA200_close_BTC <- data.frame(MA200_BTC,Date_MA)

ggplot(Bitcoin_data, aes(x = date)) +
  geom_line(aes(y=MA200_BTC), colour = "red")+
  geom_line(aes(y=adjusted), colour = "blue")
```

```{r Fucktion til MA}

Call_MA <- function(Stock,y,k){
  
  x <- tq_get(Stock, get = "stock.prices", from = "0000-01-01")
  
  Data <- x[,c(2,8)]
  
  Data_nona <- na.omit(Data)
  
  MA <- c(rollmean(Data_nona$adjusted,y))

  ggplot(tail(Data_nona,n=k), aes(x = date)) +
  geom_line(aes(y=tail(MA,n=k)), colour = "red")+
  geom_line(aes(y=adjusted), colour = "blue")
}

Call_MA("^NDX",200,7000)

data <- btc %>% filter(!is.na(adjusted)) %>%
  mutate(logr = c(NA, diff(log(adjusted)))) %>% 
  select(date, logr) %>% na.omit()

ggplot(data) +
  geom_line(aes(x = date, y = logr))


```

```{r TSLA Og VW plot}
TSLA_data <- tq_get("TSLA", get = "stock.prices", from = "2019-01-01")

plot_TSLA <- ggplot(TSLA_data, aes(x = date, y = adjusted)) +
  geom_line() + ggtitle("TSLA")

VOW_data <- tq_get("VOW.DE", get = "stock.prices", from = "2019-01-01")

plot_VOW <- ggplot(VOW_data, aes(x = date, y = adjusted)) +
  geom_line() + ggtitle("VOW.DE")

grid.arrange(plot_TSLA, plot_VOW, ncol =2 )

```

